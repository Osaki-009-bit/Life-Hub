<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life-Hub Schedule AGGREGATOR</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .has-reg::after { content: ''; display: block; width: 6px; height: 6px; background: #2563eb; margin: 2px auto; border-radius: 50%; }
        .has-game::after { content: ''; display: block; width: 6px; height: 6px; background: #ef4444; margin: 2px auto; border-radius: 50%; }
        .selected-day { background-color: #eff6ff; border: 2px solid #2563eb; border-radius: 12px; }
        .modal-active { display: flex !important; }
        input, select { height: 55px; font-size: 15px !important; font-weight: 900 !important; }
    </style>
</head>
<body class="bg-gray-100 pb-32">

    <div class="bg-white shadow-xl px-6 pt-8 pb-6 rounded-b-[3rem]">
        <h1 class="text-2xl font-[900] italic tracking-tighter text-blue-900 uppercase mb-6 text-center">Life-Hub <span class="text-blue-500">AGGREGATOR</span></h1>
        
        <div class="relative mb-2">
            <label class="text-[10px] font-black text-blue-600 ml-1 uppercase">æ–°å¢/æœç´¢è¯¾ç¨‹é¡¹ç›®</label>
            <input type="text" id="courseInput" list="courseHistory" placeholder="è¾“å…¥è¯¾ç¨‹å (å¦‚: ç¯®çƒè¯¾)" 
                   class="w-full p-4 border-2 border-blue-50 border-gray-50 rounded-2xl bg-gray-50 text-base font-black outline-none focus:border-blue-500">
            <datalist id="courseHistory"></datalist>
        </div>
    </div>

    <div class="mx-6 mt-6 p-7 bg-white rounded-[2.8rem] shadow-2xl space-y-4">
        <div class="flex border-b border-gray-100 mb-2">
            <button onclick="setMode('regular')" id="tabReg" class="flex-1 py-3 text-[11px] font-black border-b-4 border-blue-600 text-blue-600">å¸¸è§„å‘¨è¯¾</button>
            <button onclick="setMode('special')" id="tabSpec" class="flex-1 py-3 text-[11px] font-black text-gray-400">æ¯”èµ›/å˜åŠ¨</button>
        </div>

        <div id="dateInputArea" class="hidden">
            <input type="date" id="specDate" class="w-full p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">
        </div>

        <div class="grid grid-cols-2 gap-3">
            <input type="time" id="startTime" class="p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">
            <input type="time" id="endTime" class="p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">
        </div>

        <div id="regExtra" class="grid grid-cols-2 gap-3">
            <div class="relative">
                <input type="number" id="sessions" placeholder="æ€»è¯¾æ—¶" class="w-full p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">
                <span class="absolute right-4 top-4 text-[10px] font-black text-gray-400 uppercase">èŠ‚</span>
            </div>
            <div class="relative">
                <input type="text" id="range" placeholder="å‡ æœˆåˆ°å‡ æœˆ" class="w-full p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">
                <span class="absolute right-4 top-4 text-[10px] font-black text-gray-400 uppercase">æœˆ</span>
            </div>
        </div>

        <input type="text" id="loc" placeholder="ä¸Šè¯¾/æ¯”èµ›åœ°ç‚¹" class="w-full p-4 border-2 border-gray-50 rounded-2xl bg-gray-50 text-sm font-black outline-none">

        <button onclick="saveEntry()" class="w-full bg-blue-600 text-white h-20 rounded-[2rem] font-[900] text-lg shadow-2xl active:scale-[0.96] transition-all uppercase tracking-widest">Commit Course</button>
    </div>

    <div id="projectContainer" class="px-6 mt-8 space-y-4"></div>

    <div id="calendarModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden flex-col justify-end">
        <div class="bg-white rounded-t-[3rem] p-8 space-y-6 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center">
                <h2 id="modalTitle" class="text-2xl font-[900] text-gray-900 uppercase">è¯¾ç¨‹è¯¦æƒ…</h2>
                <button onclick="closeModal()" class="text-gray-300 text-3xl">âœ•</button>
            </div>
            
            <div id="dayDetail" class="bg-blue-600 p-6 rounded-[2rem] text-white shadow-xl shadow-blue-100">
                <p id="detailDate" class="text-[10px] font-black uppercase opacity-80 tracking-[0.2em] mb-1">è¯·é€‰æ‹©æ—¥æœŸæŸ¥çœ‹</p>
                <p id="detailTime" class="text-2xl font-[900] leading-none my-2">--:--</p>
                <p id="detailLoc" class="text-[11px] font-bold opacity-90 italic">ğŸ“ é€‰æ‹©æ—¥å†ä¸­æœ‰ç‚¹çš„æ—¥æœŸ</p>
            </div>

            <div id="modalCalendar" class="grid grid-cols-7 gap-2 text-center text-[11px] font-black">
                </div>

            <button onclick="deleteProject()" class="w-full py-4 text-red-500 font-black text-[10px] uppercase tracking-widest opacity-30">åˆ é™¤æ•´ä¸ªè¯¾ç¨‹é¡¹ç›®æ¡£æ¡ˆ</button>
        </div>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('lh_aggregator_v1') || '[]');
        let mode = 'regular';
        let activeProject = '';

        function setMode(m) {
            mode = m;
            document.getElementById('tabReg').className = m === 'regular' ? 'flex-1 py-3 text-[11px] font-black border-b-4 border-blue-600 text-blue-600' : 'flex-1 py-3 text-[11px] font-black text-gray-400';
            document.getElementById('tabSpec').className = m === 'special' ? 'flex-1 py-3 text-[11px] font-black border-b-4 border-blue-600 text-blue-600' : 'flex-1 py-3 text-[11px] font-black text-gray-400';
            document.getElementById('dateInputArea').classList.toggle('hidden', m === 'regular');
            document.getElementById('regExtra').classList.toggle('hidden', m === 'special');
        }

        function saveEntry() {
            const name = document.getElementById('courseInput').value;
            if(!name) return alert("ç»ç†ï¼Œè¯·è¾“å…¥é¡¹ç›®åç§°ï¼");
            
            const entry = {
                id: Date.now(),
                name, mode,
                start: document.getElementById('startTime').value,
                end: document.getElementById('endTime').value,
                loc: document.getElementById('loc').value,
                day: new Date().getDay(),
                date: document.getElementById('specDate').value || new Date().toISOString().split('T')[0],
                total: document.getElementById('sessions').value,
                range: document.getElementById('range').value
            };
            db.push(entry);
            localStorage.setItem('lh_aggregator_v1', JSON.stringify(db));
            render();
        }

        function render() {
            const container = document.getElementById('projectContainer');
            const history = document.getElementById('courseHistory');
            container.innerHTML = '';
            history.innerHTML = '';

            const projects = [...new Set(db.map(i => i.name))];
            projects.forEach(p => {
                history.innerHTML += `<option value="${p}">`;
                container.innerHTML += `
                    <button onclick="openModal('${p}')" class="w-full bg-white p-8 rounded-[2.5rem] shadow-xl flex justify-between items-center border border-gray-50 active:scale-[0.97] transition-all">
                        <div class="text-left">
                            <p class="text-[10px] font-black text-blue-600 uppercase tracking-widest mb-1">COURSE PROJECT</p>
                            <h3 class="text-2xl font-[900] text-gray-900 uppercase">${p}</h3>
                        </div>
                        <div class="bg-gray-100 p-4 rounded-2xl text-gray-400">â”</div>
                    </button>
                `;
            });
        }

        function openModal(name) {
            activeProject = name;
            document.getElementById('modalTitle').innerText = name;
            document.getElementById('calendarModal').classList.add('modal-active');
            renderModalCalendar();
        }

        function closeModal() {
            document.getElementById('calendarModal').classList.remove('modal-active');
        }

        function renderModalCalendar() {
            const grid = document.getElementById('modalCalendar');
            grid.innerHTML = '<div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>';
            
            const now = new Date();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            const projectData = db.filter(i => i.name === activeProject);

            for(let i = 1; i <= daysInMonth; i++) {
                const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${i.toString().padStart(2,'0')}`;
                const cellDate = new Date(now.getFullYear(), now.getMonth(), i);
                
                const hasReg = projectData.some(p => p.mode === 'regular' && p.day === cellDate.getDay());
                const hasGame = projectData.some(p => p.mode === 'special' && p.date === dateStr);
                
                const dayBtn = document.createElement('button');
                dayBtn.innerText = i;
                dayBtn.className = "py-4 relative font-black text-gray-400";
                if(hasReg) dayBtn.classList.add('has-reg', 'text-gray-900');
                if(hasGame) dayBtn.classList.add('has-game', 'text-gray-900');
                
                dayBtn.onclick = () => {
                    document.querySelectorAll('#modalCalendar button').forEach(b => b.classList.remove('selected-day'));
                    dayBtn.classList.add('selected-day');
                    showDayDetail(dateStr, cellDate.getDay());
                };
                grid.appendChild(dayBtn);
            }
        }

        function showDayDetail(dateStr, dayNum) {
            const entry = db.filter(i => i.name === activeProject).find(i => 
                (i.mode === 'special' && i.date === dateStr) || (i.mode === 'regular' && i.day === dayNum)
            );

            if(entry) {
                document.getElementById('detailDate').innerText = `${dateStr} | ${['å‘¨æ—¥','å‘¨ä¸€','å‘¨äºŒ','å‘¨ä¸‰','å‘¨å››','å‘¨äº”','å‘¨å…­'][dayNum]}`;
                document.getElementById('detailTime').innerText = `${entry.start} - ${entry.end}`;
                document.getElementById('detailLoc').innerText = `ğŸ“ ${entry.loc || 'æœªè®¾å®šåœ°ç‚¹'}`;
            }
        }

        function deleteProject() {
            if(confirm("ç»ç†ï¼Œç¡®å®šåˆ é™¤æ­¤é¡¹ç›®æ‰€æœ‰æ¡£æ¡ˆï¼Ÿ")) {
                db = db.filter(i => i.name !== activeProject);
                localStorage.setItem('lh_aggregator_v1', JSON.stringify(db));
                closeModal();
                render();
            }
        }

        render();
    </script>
</body>
</html>
